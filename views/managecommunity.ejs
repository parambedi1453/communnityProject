<!DOCTYPE html>
<html>
    <head>
        <% include partials/bootstrap.ejs %>

    </head>
    <style>
        #communityHeaderOfMobile
        {
            width: 100%;
            text-align: center;
            height: 80px;
            background-image: linear-gradient(to bottom, #4ba2b7, #42a6be, #38aac6, #29adcd, #0fb1d5);

        }
        /* #askbtndiv
        {
            display : none;
        } */
        /* #btnToJoin
        {
            color: #fff;
            background: transparent;
            border-color: #fff;
        } */
        #headerCommImage1
        {
            height: 90px;
            width: 90px;
            position: relative;
            margin-top: 25px;
            margin-left: 0px;
            box-shadow: 0 0 10px rgba(0,0,0,0.6);
        }

        #mobileCq
        {
            font-size: 15px;
            width: 80%;
            margin: 0;
            overflow: auto;
            height: auto;
            font-weight: bold;
            display: block;
            color: #fff;
            text-transform: capitalize;
        }
        #communityHeaderOfLap
        {
            padding-top: 70px;
        }
        #lapDiv1
        {
            display:none;
        }
        #lapDiv2
        {
            display:none;
        }
        /***********SETTTINGS **********/
        #nonlink
        {
            width: 80%;
        color: #6F6E6E;
        font-size: 16px;
        font-weight: bold;
        text-decoration: none;
        cursor: pointer;
        padding: 4px;
        margin-top: 2px;
        text-decoration: none;
        }
        #editCommLink
        {
            display:none;
        }



        .dropdown-content {
             display: none;
            position: absolute;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;

         }

        .dropdown-content a:hover {background-color: #ddd}
        .show {display:block;}

        @media (min-width:768px)
        {
            #communityHeaderOfMobile
            {
                height: 50px;
                width: 100%;
                background-image: linear-gradient(to bottom, #4ba2b7, #42a6be, #38aac6, #29adcd, #0fb1d5);

            }
            #communityHeaderOfLap
            {
                padding-top: 0px;
            }
            /* #askbtndiv
            {
                display : block !important;
            } */
            #headerCommImage1
            {
                display:none;
            }
            #headerCommImage2
            {
                background: rgb(255, 255, 255) !important;
                height: 100px;
                width: 100px;
                z-index: 2;
                position: absolute;
                margin-top: -40px;
                border: 4px solid #fff;
                box-shadow: 0 0 10px rgba(0,0,0,0.6);
            }
            #mobileCq
            {
                display:none;
            }
            #lapDiv1
            {
                display:block;
            }
            #lapDiv2
            {
                display:block;
                margin-left:-25px;
            }
            #lapDiv2
            {
                z-index: 1;
                height: 60px;
                margin-top: 15px;
                font-size: 20px;
                font-family: 'Open Sans', sans-serif;
                text-transform: capitalize;
                font-weight: bold;
            }
            #editCommLink
            {
                display:block;
            }
            #editCommpanel
            {
                display:none;
            }

        }
    </style>
    <body>
        <% include partials/header.ejs %>
            <div id="viewscreen">
                <% include partials/sidebar.ejs %>
                    <div id="rightview">
                        <div class="container-fluid" style="min-width:368px;padding:0;">
                            <div class="row">
                                <div class="col-lg-12" >
                                    <div id="communityHeaderOfMobile" style="padding-top:6px;position:relative;">
                                         <!-- <div class="container" id="askbtndiv">
                                            <button class="btn btn-info" id="btnToJoin" style="float:right;border-radius:0">
                                                <i class="fa fa-ask"></i>
                                                <% if (objcomm.commrule == "d" ) { %>
                                                    JOIN+
                                                <% }else{ %>
                                                    ASK TO JOIN
                                                    <%}%>
                                            </button>
                                        </div> -->
                                        <center>
                                            <div id="mobileCq" style="max-height:40px;">
                                                <a style="color:white;font-size: 15px;font-weight: bold;"><%= objcomm.commname %></a>
                                            </div>
                                        </center>
                                        <center>
                                            <a>
                                                <img src="/defaultcomm.png" id="headerCommImage1" >
                                            </a>
                                        </center>
                                    </div>

                                    <div  class="container" id="communityHeaderOfLap">
                                        <div class="col-sm-2 col-xs-12"  id="lapDiv1">
                                            <a><img src="/defaultcomm.png" id="headerCommImage2"></a>
                                        </div>
                                        <div class="col-sm-8" id="lapDiv2">
                                            <a><%= objcomm.commname %></a>
                                        </div>
                                        <div class="col-sm-2 col-xs-12" style="padding-top:10px;float:right;">
                                            <div class="dropdown">
                                                <button class="btn btn-default dropbtn" onclick = "toOpenListFunc()">
                                                    <i class="fa fa-bars"></i>
                                                </button>
                                                 <div id="myDropdown" class="dropdown-content" style="margin-top:40px;">

                                                    <a>Dicussions</a><br>
                                                    <a>Manage community</a><br>
                                                    <a>Community Profile</a><br>
                                                    <a>Community Members</a><br>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <center>
                                        <hr style="border-top: 2px solid #E6E6E6; width: 85%;margin-top: 0;">
                                    </center>

                                    <!-- MAIN CONTENT OF PAGE BEGINS -->
                                    <div class="container">
                                        <p id="getCommId" style="display:none"><%= objcomm._id %></p>
                                        <div class="col-sm-12 col-xs-12 col-md-12 col-lg-12" style="padding-bottom:5px;border-bottom: 1px solid #c4c4c4;">
                                            <nonlink style="cursor:context-menu;" id="nonlink">
                                                Manage Community
                                            </nonlink>
                                            <a style="float:right;font-weight: 600">Invite Users</a>
                                            <a id="editCommLink" style="float: right;font-weight: 600;margin-right: 15px;">Edit Community</a>
                                        </div>

                                        <div class="col-sm-12 col-xs-12 col-md-12 col-lg-12" style="padding : 10px 0 0 0;">
                                            <div class="col-sm-3" style="padding:0;box-shadow:0 3px 10px 0 rgba(115,143,147,.3);">
                                                <div class="panel-heading" id="editCommpanel" style="background: #fff;margin-bottom: 5px;">
                                                    <center>
                                                        <a class="btn btn-primary" >
                                                            Edit Community
                                                        </a>
                                                    </center>
                                                </div>
                                                <div class="panel-body" style="background: #fff;  box-shadow:0 3px 10px 0 rgba(115,143,147,.3);">
                                                    <center>
                                                        <a id="ausers">Users(<%= objcomm.commjoin.length %>)</a><br>
                                                        <a id="amanager">Managers()</a><br>
                                                        <a id="arequest">Requests(<%= objcomm.commasktojoin.length %>)</a><br>
                                                        <a id="ainvite">Invited Members(<%= objcomm.comminvite.length %>)</a><br>
                                                    </center>
                                                </div>
                                                <br>
                                            </div>

                                            <div class="col-sm-9" id="listOfUMRI">
                                                <div id="rowAppend">
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
            </div>
    </body>
    <script src="/openpanel.js">
    </script>
    <script>

            var adminsidebar = document.getElementById('admin_as_admin')
            adminsidebar.setAttribute("style","display:none");
            var usersidebar = document.getElementById('admin_as_user')
            usersidebar.setAttribute("style","display:block")
            //*****************************************************************

        function toOpenListFunc() {
          document.getElementById("myDropdown").classList.toggle("show");
        }

        // Close the dropdown menu if the user clicks outside of it
        window.onclick = function(event) {
          if (!event.target.matches('.dropbtn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        }
    </script>
    <script>

        var parentDiv = document.getElementById("listOfUMRI");
        var smallParent = document.getElementById("rowAppend");
        var ausers = document.getElementById("ausers");
        var amanager = document.getElementById("amanager");
        var arequest = document.getElementById("arequest");
        var ainvite = document.getElementById("ainvite");

        var joinArr = [];
        var askjoinArr = [];
        var inviteArr = [];

        getCommunityDetails();

        function getCommunityDetails()
        {
            var getid = document.getElementById("getCommId").innerHTML;
            var ob  = new Object();
            ob.id = getid;
            var request = new XMLHttpRequest();
            var filename = '/getcommdetails';
            request.open('POST',filename);
            request.setRequestHeader("content-Type","application/JSON");
            request.send(JSON.stringify(ob));
            request.onload = function()
            {
                var obj = JSON.parse(request.responseText);
                console.log(obj);

                //BY default Page will Have USERS
                for(var i in obj.commjoin)
                {
                    console.log("gfhkj")
                    addToDom(obj.commjoin[i]);
                }

                ausers.onclick = function()
                {
                    smallParent.innerHTML = "";
                    for(var i in obj.commjoin)
                    {
                        console.log("gfhkj")
                        addToDom(obj.commjoin[i]);
                    }
                }
                arequest.onclick = function()
                {
                    smallParent.innerHTML = "";
                    for(var i in obj.commasktojoin)
                    {
                        console.log("gfhkj")
                        addToDom2(obj.commasktojoin[i]);
                    }
                }
                amanager.onclick = function()
                {
                    smallParent.innerHTML = "";
                    console.log(obj.ownerid);
                    addToDom3(obj.ownerid);
                }

            }

        }
        function addToDom(ob)
        {
            var div1 = document.createElement("div");
            div1.setAttribute("class","col-sm-12 col-xs-12");
            div1.setAttribute("style","border-top: 1px solid #ccc;border-bottom: 1px solid #ccc;margin-top:5px");


            var div11 = document.createElement("div");
            div11.setAttribute("class","col-sm-2 col-xs-3");
            div11.setAttribute("style","padding:5px");
            var a11 = document.createElement("a");
            a11.setAttribute("href","#");
            var img11 = document.createElement("img");
            img11.setAttribute("src",ob.photoname);
            img11.setAttribute("style","height: 50px;width: 50px;border: 3px solid #fff;border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.5)")
            a11.appendChild(img11);
            div11.appendChild(a11);
            div1.appendChild(div11);


            var div12 = document.createElement("div");
            div12.setAttribute("class","col-sm-8 col-xs-6");
            var a12 = document.createElement("a");
            a12.setAttribute("href","#");
            a12.setAttribute("style","margin-top: 20px;font-weight: bold;font-size: 18px; display: inline-block;text-transform: capitalize;cursor: pointer;color: #337ab7;");
            a12.innerHTML = ob.name;
            div12.appendChild(a12);
            div1.appendChild(div12);


            var div13 = document.createElement("div");
            div13.setAttribute("class","col-sm-2 col-xs-3");
            a13 = document.createElement("a");
            a13.setAttribute("style","float:left;margin-top: 20px;color: #7D7D7D;font-size: 20px;text-decoration: none;text-transform: capitalize;");
            i13 = document.createElement("i");
            i13.setAttribute("class","fa fa-chevron-up");
            a13.appendChild(i13);
            div13.appendChild(a13);

            a14 = document.createElement("a");
            a14.setAttribute("style","float:right;margin-top: 20px;color: #7D7D7D;font-size: 20px;text-decoration: none;text-transform: capitalize;");
            i14 = document.createElement("i");
            i14.setAttribute("class","fa fa-times");
            a14.appendChild(i14);
            a14.appendChild(i14);
            div13.appendChild(a14);

            div1.appendChild(div13);

            smallParent.appendChild(div1);

}


function addToDom2(ob)
{
    var div1 = document.createElement("div");
    div1.setAttribute("class","col-sm-12 col-xs-12");
    div1.setAttribute("style","border-top: 1px solid #ccc;border-bottom: 1px solid #ccc;margin-top:5px");


    var div11 = document.createElement("div");
    div11.setAttribute("class","col-sm-2 col-xs-3");
    div11.setAttribute("style","padding:5px");
    var a11 = document.createElement("a");
    a11.setAttribute("href","#");
    var img11 = document.createElement("img");
    img11.setAttribute("src",ob.photoname);
    img11.setAttribute("style","height: 50px;width: 50px;border: 3px solid #fff;border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.5)")
    a11.appendChild(img11);
    div11.appendChild(a11);
    div1.appendChild(div11);


    var div12 = document.createElement("div");
    div12.setAttribute("class","col-sm-8 col-xs-6");
    var a12 = document.createElement("a");
    a12.setAttribute("href","#");
    a12.setAttribute("style","margin-top: 20px;font-weight: bold;font-size: 18px; display: inline-block;text-transform: capitalize;cursor: pointer;color: #337ab7;");
    a12.innerHTML = ob.name;
    div12.appendChild(a12);
    div1.appendChild(div12);


    var div13 = document.createElement("div");
    div13.setAttribute("class","col-sm-2 col-xs-3");
    b13 = document.createElement("button");
    b13.setAttribute("class","btn btn-default");
    b13.setAttribute("style","float:right;margin-top:15px;");
    b13.innerHTML = "Option"

    div13.appendChild(b13);

    div1.appendChild(div13);

    smallParent.appendChild(div1);

}
function addToDom3(ob)
{
    console.log(ob.name);

    var div1 = document.createElement("div");
    div1.setAttribute("class","col-sm-12 col-xs-12");
    div1.setAttribute("style","border-top: 1px solid #ccc;border-bottom: 1px solid #ccc;margin-top:5px");


    var div11 = document.createElement("div");
    div11.setAttribute("class","col-sm-2 col-xs-3");
    div11.setAttribute("style","padding:5px");
    var a11 = document.createElement("a");
    a11.setAttribute("href","#");
    var img11 = document.createElement("img");
    img11.setAttribute("src",ob.photoname);
    img11.setAttribute("style","height: 50px;width: 50px;border: 3px solid #fff;border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.5)")
    a11.appendChild(img11);
    div11.appendChild(a11);
    div1.appendChild(div11);


    var div12 = document.createElement("div");
    div12.setAttribute("class","col-sm-8 col-xs-6");
    var a12 = document.createElement("a");
    a12.setAttribute("href","#");
    a12.setAttribute("style","margin-top: 20px;font-weight: bold;font-size: 18px; display: inline-block;text-transform: capitalize;cursor: pointer;color: #337ab7;");
    a12.innerHTML = ob.name;
    div12.appendChild(a12);
    div1.appendChild(div12);


    var div13 = document.createElement("div");
    div13.setAttribute("class","col-sm-2 col-xs-3");
    span = document.createElement("span");
    span.setAttribute("class","label label-success");
    span.setAttribute("style","margin-top:25px;float:right");
    span.innerHTML = "Owner";
    div13.appendChild(span);

    div1.appendChild(div13);

    smallParent.appendChild(div1);
}

    </script>
</html>
